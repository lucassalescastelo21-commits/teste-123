<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Notícias - Mídia Indoor</title>

<style>
*{box-sizing:border-box}

body{
    margin:0;
    background:black;
    font-family:Arial, Helvetica, sans-serif;
    color:white;
    overflow:hidden;
}

#slideshow{
    width:100vw;
    height:100vh;
    position:relative;
}

.slide{
    position:absolute;
    inset:0;
    display:none;
    flex-direction:column;
}

.slide.active{
    display:flex;
}

.img{
    flex:1;
    background-size:cover;
    background-position:center;
}

.text{
    background:rgba(0,0,0,.78);
    padding:25px;
}

h1{
    margin:0 0 10px;
    font-size:36px;
}

p{
    margin:0;
    font-size:20px;
    color:#ddd;
}

footer{
    position:absolute;
    bottom:0;
    width:100%;
    text-align:center;
    padding:8px;
    background:#111;
    font-size:14px;
}
</style>
</head>

<body>

<div id="slideshow"></div>
<footer>Atualização automática • 40 notícias • Troca a cada 10s</footer>

<script>
const rss = 'https://g1.globo.com/rss/g1/';
const proxy = 'https://api.allorigins.win/raw?url=' + encodeURIComponent(rss);

const MAX_NOTICIAS = 40;   // Quantidade de notícias no loop
const TEMPO_TROCA = 10000; // 10 segundos por slide

let slides = [];
let index = 0;

async function carregarNoticias(){
    try{
        const res = await fetch(proxy);
        const text = await res.text();
        const xml = new DOMParser().parseFromString(text,'text/xml');
        const items = xml.querySelectorAll('item');

        montarSlides([...items].slice(0, MAX_NOTICIAS));
    }catch(e){
        document.getElementById('slideshow').innerHTML =
            '<h1 style="padding:30px">Erro ao carregar notícias</h1>';
    }
}

function extrairImagem(desc){
    const div = document.createElement('div');
    div.innerHTML = desc;
    const img = div.querySelector('img');
    return img ? img.src : null;
}

function montarSlides(items){
    const box = document.getElementById('slideshow');
    box.innerHTML='';
    slides=[];

    items.forEach((item,i)=>{
        const title = item.querySelector('title')?.textContent || '';
        const descHtml = item.querySelector('description')?.textContent || '';
        const texto = descHtml.replace(/<[^>]*>/g,'').substring(0,240);

        let img = extrairImagem(descHtml);

        if(!img){
            img = 'https://picsum.photos/1280/720?random='+i;
        }

        const slide = document.createElement('div');
        slide.className='slide';

        slide.innerHTML=`
            <div class="img" style="background-image:url('${img}')"></div>
            <div class="text">
                <h1>${title}</h1>
                <p>${texto}...</p>
            </div>
        `;

        box.appendChild(slide);
        slides.push(slide);
    });

    index=0;
    mostrar();
}

function mostrar(){
    if(slides.length === 0) return;
    slides.forEach(s=>s.classList.remove('active'));
    slides[index].classList.add('active');
    index = (index+1)%slides.length;
}

setInterval(mostrar, TEMPO_TROCA);
setInterval(carregarNoticias, 300000); // Atualiza feed a cada 5 minutos

carregarNoticias();
</script>

</body>
</html>
